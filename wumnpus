import random as rand
import time
import os
import platform

def rensa_terminalen():
    if platform.system() == "Windows":
        os.system('cls')
    else:
        os.system('clear')
        
def Ã¤r_anvÃ¤ndaren_redo():
    input("Tryck pÃ¥ enter fÃ¶r att forsÃ¤tta king ğŸ’…")

class Spelare:
    def __init__(self, spelare: str, karta: list, rums_karta: list, wumpus: "Wumpus", position: list = [0, 0], status: bool = True, pilar: int = 5):
        self.status = status
        self.spelare = spelare
        self.karta = karta           
        self.rums_karta = rums_karta     
        self.position = position
        self.pilar = pilar
        self.wumpus = wumpus

    def flytta_objekt(self, vÃ¤derstreck: str,):
        x, y = self.position

        if vÃ¤derstreck == "N":
            nytt_x, nytt_y = x - 1, y
        elif vÃ¤derstreck == "S":
            nytt_x, nytt_y = x + 1, y
        elif vÃ¤derstreck == "V":
            nytt_x, nytt_y = x, y - 1
        elif vÃ¤derstreck == "Ã–":
            nytt_x, nytt_y = x, y + 1
        else:
            print("Du kan endast fÃ¶rflytta dig med kommandon N/S/V/Ã–. ğŸ¤£")
            return  

        if 0 <= nytt_x < 8 and 0 <= nytt_y < 7:
            if [nytt_x, nytt_y] == self.wumpus.position: 
                self.position = [nytt_x, nytt_y]
                print("Du gick in Wumpus, han kÃ¤kade upp dig. Du var god.")
                self.status = False
                return
            
            else:
                self.position = [nytt_x, nytt_y]
                print(f"Du har flyttat till {self.position} (rum {self.rums_karta[nytt_x][nytt_y]}).")
        else:
            print("Du fÃ¶rsÃ¶ker gÃ¥ in i en vÃ¤gg... spelet Ã¤r inte sÃ¥ stressfullt. â˜œ(ï¾Ÿãƒ®ï¾Ÿâ˜œ)")
            return  

        
        self.omkringliggande_rum()
        self.kolla_fladdermus()
        self.kolla_bottomlÃ¶st_hÃ¥l()
        self.kolla_wumpus()

    def omkringliggande_rum(self):
        x, y = self.position
        riktningar = [(-1, 0), (1, 0), (0, -1), (0, 1)]   
        rum_omkring_spelare = []    
        
        nuvarande_x = x  
        nuvarande_y = y  
      
        for riktning in riktningar:       
            vertikal_riktning = riktning[0]
            horisontell_riktning = riktning[1]
            
            ny_x = nuvarande_x + vertikal_riktning
            ny_y = nuvarande_y + horisontell_riktning
        
            if 0 <= ny_x < 8 and 0 <= ny_y < 7:        
                rumsnummer = self.rums_karta[ny_x][ny_y]              
                rum_omkring_spelare.append(rumsnummer)
                
            radera_dubletter_av_rum = list(set(rum_omkring_spelare))
            
            radera_dubletter_av_rum.sort()
        print("HÃ¤rifrÃ¥n kan man komma till fÃ¶ljande rum:", ' '.join(map(str, radera_dubletter_av_rum)))

    def kolla_fladdermus(self):
        x, y = self.position
        karta = self.karta

        
        if x > 0 and karta[x-1][y] == "F":
            print("Du hÃ¶r FladdermÃ¶ss.")
        if x < len(karta) - 1 and karta[x+1][y] == "F":
            print("Du hÃ¶r FladdermÃ¶ss.")
        if y > 0 and karta[x][y-1] == "F":
            print("Du hÃ¶r FladdermÃ¶ss.")
        if y < len(karta[0]) - 1 and karta[x][y+1] == "F":
            print("Du hÃ¶r FladdermÃ¶ss.")
        
        if karta[x][y] == "F":
            print("Du kÃ¤nner fladdermusvingar mot kinden och lyfts uppÃ¥t ğŸ¤‘")
            self.fladdermus_flytta()

    def fladdermus_flytta(self):
        while True:
            nytt_x = rand.randint(0, 7)
            nytt_y = rand.randint(0, 6)
            
            if self.karta[nytt_x][nytt_y] not in ["F", "H", "W"]:
                self.position = [nytt_x, nytt_y]
                print(f"Du blev flyttad till {self.position} (rum {self.rums_karta[nytt_x][nytt_y]}).")
                
                self.omkringliggande_rum()
                break

    def skjuta_pil(self):
        if self.pilar <= 0:
            print("Du har inga pilar kvar loser ğŸ˜­ğŸ™")
            return

        print(f"Du har {self.pilar} pilar, nÃ¤r du skjuter kan du styra pilen 3 drag m.h.a N/S/V/Ã–")
        pil_position = [self.position[0], self.position[1]]

        for i in range(3):  
            vÃ¤derstreck = input(f"Du kan styra pilen, {3 - i} drag kvar. Vilken riktning (N/S/V/Ã–)? ").upper()
            if vÃ¤derstreck == "N":
                nytt_x, nytt_y = pil_position[0] - 1, pil_position[1]
            elif vÃ¤derstreck == "S":
                nytt_x, nytt_y = pil_position[0] + 1, pil_position[1]
            elif vÃ¤derstreck == "V":
                nytt_x, nytt_y = pil_position[0], pil_position[1] - 1
            elif vÃ¤derstreck == "Ã–":
                nytt_x, nytt_y = pil_position[0], pil_position[1] + 1
            else:
                print("Endast N/S/V/Ã– Ã¤r giltiga kommandon, lÃ¥t mig inte sÃ¤ga det igen ğŸ˜¡.")
                break

            if 0 <= nytt_x < 8 and 0 <= nytt_y < 7:
                pil_position = [nytt_x, nytt_y]
                print(f"Pilen flyttad till {pil_position}. ğŸ˜ˆ")
                
                if self.karta[nytt_x][nytt_y] == "W":
                    print("Pilen trÃ¤ffade Wumpus! Du vinner!")
                    self.status = False
                    return
            else:
                print("Du kÃ¶rde in pilen i en vÃ¤gg och den gick sÃ¶nder...")
                break

        self.pilar -= 1
        print(f"Du har nu {self.pilar} pilar kvar.ğŸ˜¢")

        if self.status:  
            if self.pilar == 0:
                print("Du har slut pÃ¥ pilar gubben/gumman")
            else:
                print("Pilen missade. Du har alltsÃ¥ inte vunnit lmao")

    def kolla_bottomlÃ¶st_hÃ¥l(self):
        x, y = self.position
        karta = self.karta

        
        if x > 0 and karta[x-1][y] == "H":
            print("Du kÃ¤nner susningarna av ett djupt hÃ¥lğŸ˜¨")
        if x < len(karta) - 1 and karta[x+1][y] == "H":
            print("Du kÃ¤nner susningarna av ett djupt hÃ¥lğŸ˜¨")
        if y > 0 and karta[x][y-1] == "H":
            print("Du kÃ¤nner susningarna av ett djupt hÃ¥lğŸ˜¨")
        if y < len(karta[0]) - 1 and karta[x][y+1] == "H":
            print("Du kÃ¤nner susningarna av ett djupt hÃ¥lğŸ˜¨")
        
        if karta[x][y] == "H":
            print("Du har gÃ¥tt ner i ett hÃ¥l och Ã¤r numera stendÃ¶d ğŸ’€")
            self.status = False
            
    def kolla_wumpus(self): 
        x, y = self.position
        karta = self.karta
        
        if x > 0 and karta[x-1][y] == "W":
            print("Du kÃ¤nner Wumpus vidriga luktğŸ¤¢")
        if x < len(karta) - 1 and karta[x+1][y] == "W":
            print("Du kÃ¤nner Wumpus vidriga luktğŸ¤¢")
        if y > 0 and karta[x][y-1] == "W":
            print("Du kÃ¤nner Wumpus vidriga luktğŸ¤¢")
        if y < len(karta[0]) - 1 and karta[x][y+1] == "W":
            print("Du kÃ¤nner Wumpus vidriga luktğŸ¤¢")

class Wumpus:
    def __init__(self, karta: list):
        self.karta = karta
        self.position = self.fÃ¶d_wumpus()

    def fÃ¶d_wumpus(self):
        while True:
            x = rand.randint(0, 7)
            y = rand.randint(0, 6)
            if self.karta[x][y] == ".":
                self.karta[x][y] = "W"
                return [x, y]

    def flytta_wumpus(self, spelar_position: list):
        
        x, y = self.position
        self.karta[x][y] = "."  

        while True:
            wumpus_riktning = rand.choice([(-1, 0), (0, -1), (1, 0), (0, 1)])
            steg_x, steg_y = wumpus_riktning
            nytt_x = x + steg_x
            nytt_y = y + steg_y
            if 0 <= nytt_x < 8 and 0 <= nytt_y < 7:
                
                if [nytt_x, nytt_y] == spelar_position:
                    print("Wumpus hittade dig och kÃ¤kade upp dig. nomnomnom")
                    self.position = [nytt_x, nytt_y]
                    self.karta[nytt_x][nytt_y] = "W"
                    return
                    
                if self.karta[nytt_x][nytt_y] == "H":
                    continue
                if self.karta[nytt_x][nytt_y] == "F":
                    print(f"Wumpus Ã¥t precis en fladdermus pÃ¥ positionen: {nytt_x}, {nytt_y}")
                self.karta[nytt_x][nytt_y] = "W"
                self.position = [nytt_x, nytt_y]
                break

def generera_rumskarta():
    rums_karta = []
    for i in range(8):
        rad = []
        for j in range(7):
            rumsnummer = rand.randint(0, 9)
            rad.append(rumsnummer)
        rums_karta.append(rad)
    return rums_karta

def generera_karta():
    karta = []
    for i in range(8):
        rad = ["."] * 7  
        karta.append(rad)
    
    antal_positioner = len(karta) * len(karta[0])
    
    fladdermÃ¶ss_antal = antal_positioner * 30 // 100
    for i in range(fladdermÃ¶ss_antal):
        while True:
            x = rand.randint(0, 7)
            y = rand.randint(0, 6)
            if (x, y) != (0, 0) and karta[x][y] == ".":
                karta[x][y] = "F"
                break

    bottomlÃ¶st_hÃ¥l_antal = antal_positioner * 20 // 100
    for i in range(bottomlÃ¶st_hÃ¥l_antal):
        while True:
            x = rand.randint(0, 7)
            y = rand.randint(0, 6)
            if (x, y) != (0, 0) and karta[x][y] == ".":
                karta[x][y] = "H"
                break
    return karta

def skriv_ut_karta_pÃ¥_fil(karta, rums_karta, spelar_position, wumpus_position):
    with open("wumpus_kÃ¤llare.csv", "w", encoding="utf-8") as utfil:
        for i in range(8):
            for j in range(7):
                position = karta[i][j]
                if [i, j] == spelar_position: 
                    position = "S"
                utfil.write(f"{position}/{rums_karta[i][j]};")
            utfil.write("\n")

def vad_heter_anvÃ¤ndaren():
    namn = input("Vad heter du? ")
    return namn

def rÃ¶r_spelare(karta, rums_karta):
    namn = vad_heter_anvÃ¤ndaren()
    wumpus = Wumpus(karta)
    anvÃ¤ndare = Spelare(namn, karta, rums_karta, wumpus)
    
    print(f"Tjenare {namn}, din startposition Ã¤r {anvÃ¤ndare.position} i (rum {rums_karta[0][0]})")
    anvÃ¤ndare.omkringliggande_rum()
    skriv_ut_karta_pÃ¥_fil(karta, rums_karta, anvÃ¤ndare.position, wumpus.position)
    while anvÃ¤ndare.status:
        print(f"Du stÃ¥r pÃ¥ position: {anvÃ¤ndare.position} i (rum {rums_karta[anvÃ¤ndare.position[0]][anvÃ¤ndare.position[1]]})")
        val = input("Vill du fÃ¶rflytta dig eller skjuta (F/S)? ").upper()
        
        if val == "F":
            riktning = input("Vart vill du fÃ¶rflytta dig? (N/S/V/Ã–): ").upper()
            anvÃ¤ndare.flytta_objekt(riktning)
        elif val == "S":
            anvÃ¤ndare.skjuta_pil()
        else:
            print("Du kan bara skriva F/S... PAJAS")
            continue  

        if anvÃ¤ndare.status:
            wumpus.flytta_wumpus(anvÃ¤ndare.position)
        
        skriv_ut_karta_pÃ¥_fil(karta, rums_karta, anvÃ¤ndare.position, wumpus.position)
        
        Ã¤r_anvÃ¤ndaren_redo()
        rensa_terminalen()

def introducera_anvÃ¤ndare_till_spel():
    with open("wumpus_introduktion.txt", "r", encoding="utf-8") as infil:
        for rad in infil:
            print(rad.strip())

def main():
    introducera_anvÃ¤ndare_till_spel()
    rums_karta = generera_rumskarta()
    karta = generera_karta()
    rÃ¶r_spelare(karta, rums_karta)

if __name__ == "__main__":
    main()
